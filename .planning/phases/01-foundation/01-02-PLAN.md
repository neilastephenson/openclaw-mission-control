---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/layout/Sidebar.tsx
  - src/components/layout/Header.tsx
  - src/components/layout/TabNavigation.tsx
  - src/components/layout/AppLayout.tsx
  - src/App.tsx
  - src/pages/ActivityPage.tsx
  - src/pages/ProjectsPage.tsx
  - src/pages/TasksPage.tsx
  - src/pages/UsagePage.tsx
  - src/pages/ApprovalsPage.tsx
  - src/pages/SettingsPage.tsx
  - convex/agents.ts
  - convex/stats.ts
autonomous: true

must_haves:
  truths:
    - "Left sidebar displays a list of agents with colored status indicators (green=active, gray=idle, red=error)"
    - "Clicking an agent in sidebar filters all dashboard views to that agent"
    - "Top tab bar shows five tabs: Activity, Projects, Tasks, Usage, Approvals"
    - "Clicking a tab switches the main content area to that tab's view"
    - "Header bar displays three quick stats: total agent count, pending approvals count, today's cost estimate"
    - "Gear icon in header opens a Settings page"
  artifacts:
    - path: "src/components/layout/Sidebar.tsx"
      provides: "Agent list sidebar with status indicators and click-to-filter"
      min_lines: 40
    - path: "src/components/layout/Header.tsx"
      provides: "Header bar with quick stats and settings gear icon"
      min_lines: 30
    - path: "src/components/layout/TabNavigation.tsx"
      provides: "Top tab navigation component"
      min_lines: 20
    - path: "src/components/layout/AppLayout.tsx"
      provides: "Main layout shell combining sidebar, header, tabs, and content area"
      min_lines: 30
    - path: "convex/stats.ts"
      provides: "Convex query for aggregated quick stats"
      exports: ["getQuickStats"]
  key_links:
    - from: "src/components/layout/Sidebar.tsx"
      to: "convex/agents.ts"
      via: "useQuery to fetch agent list with status"
      pattern: "useQuery.*agents"
    - from: "src/components/layout/Header.tsx"
      to: "convex/stats.ts"
      via: "useQuery to fetch quick stats"
      pattern: "useQuery.*getQuickStats"
    - from: "src/components/layout/TabNavigation.tsx"
      to: "src/App.tsx"
      via: "React Router navigation or state-based tab switching"
      pattern: "navigate|setActiveTab"
---

<objective>
Customize the stock openclaw-mission-control UI to add: (1) a left sidebar with agent list and live status indicators, (2) top tab navigation with Activity/Projects/Tasks/Usage/Approvals tabs, (3) a header bar with quick stats, and (4) a settings page accessible via gear icon.

Purpose: Transform the generic mission control into Neil's agent dashboard layout. These are requirements LAYO-01 through LAYO-05.
Output: Dashboard with the target layout structure — sidebar, tabs, header, and placeholder content for each tab.
</objective>

<execution_context>
@/Users/otto/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create layout components (Sidebar, Header, TabNavigation, AppLayout)</name>
  <files>
    src/components/layout/Sidebar.tsx
    src/components/layout/Header.tsx
    src/components/layout/TabNavigation.tsx
    src/components/layout/AppLayout.tsx
    convex/agents.ts
    convex/stats.ts
  </files>
  <action>
    First, study the stock codebase structure. Read the existing layout, components, and Convex schema to understand current patterns. Then create:

    **1. Sidebar.tsx** — Left sidebar showing agent list with live status:
    - Query agents from Convex using existing agents table (check schema.ts for table name)
    - Display each agent as a row: avatar/icon, name, status dot (green circle = active, gray = idle, red = error)
    - Agent status is derived from recent activity: active = event within last 5 minutes, error = last event was an error, idle = otherwise
    - Clicking an agent sets a selectedAgentId in a React context or URL param
    - "All Agents" option at top to clear filter
    - Use Tailwind: fixed left sidebar, w-64, dark background matching stock theme, scrollable agent list
    - Show total agent count at the top of sidebar

    **2. Header.tsx** — Top header bar with quick stats:
    - Three stat cards inline: "X Agents" (total count), "X Pending" (approval count, hardcode 0 for now), "~$X.XX Today" (cost estimate, hardcode $0.00 for now)
    - Gear icon (use Tabler Icons `IconSettings`) on far right that links to /settings
    - Use Tailwind: sticky top, border-bottom, flex justify-between
    - Stats update reactively via Convex query `stats.getQuickStats`

    **3. convex/stats.ts** — Convex query for quick stats:
    - `getQuickStats` query that returns: { agentCount: number, pendingApprovals: number, todayCost: number }
    - agentCount: count of agents in the agents table
    - pendingApprovals: 0 (placeholder — will be wired in Phase 4)
    - todayCost: 0 (placeholder — will be wired in Phase 3)

    **4. convex/agents.ts** — If not already present, add a query to list all agents with status:
    - `listAgents` query returning all agents with computed status field
    - If stock repo already has agent queries, extend them rather than duplicating

    **5. TabNavigation.tsx** — Horizontal tab bar:
    - Five tabs: Activity | Projects | Tasks | Usage | Approvals
    - Active tab highlighted with bottom border and different text color
    - Uses React Router `<NavLink>` or `<Link>` for navigation (check stock routing approach)
    - Tabs are routes: /activity, /projects, /tasks, /usage, /approvals
    - Use Tailwind: flex, border-bottom, gap between tabs

    **6. AppLayout.tsx** — Wrapping layout component:
    - Combines Sidebar (left), Header (top of main area), TabNavigation (below header), and content area
    - Content area renders child routes via React Router `<Outlet>`
    - Layout: sidebar fixed left (w-64), main content area takes remaining width
    - Pass selectedAgentId down via React context so child views can filter

    IMPORTANT: Preserve the stock theme and styling. Use Tailwind classes consistent with the existing dark theme. Do NOT remove existing functionality — extend it.
  </action>
  <verify>
    - `npx tsc --noEmit` passes with no type errors
    - All new component files exist and export their components
    - convex/stats.ts exports getQuickStats query
    - `bun dev` runs without errors
  </verify>
  <done>
    Layout components created: Sidebar with agent list, Header with quick stats, TabNavigation with five tabs, AppLayout combining them all. Convex queries for agents and stats are functional.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire layout into app with routing and placeholder pages</name>
  <files>
    src/App.tsx
    src/pages/ActivityPage.tsx
    src/pages/ProjectsPage.tsx
    src/pages/TasksPage.tsx
    src/pages/UsagePage.tsx
    src/pages/ApprovalsPage.tsx
    src/pages/SettingsPage.tsx
  </files>
  <action>
    Wire the new layout into the existing app routing:

    **1. Create placeholder pages** for each tab:
    - ActivityPage.tsx — "Activity Feed" heading + placeholder text ("Real-time agent activity will appear here"). If stock repo has an activity/feed component, embed it here.
    - ProjectsPage.tsx — "Projects" heading + placeholder text ("Project kanban board coming in Phase 2")
    - TasksPage.tsx — If stock repo has the kanban board, embed the existing tasks view here. Otherwise placeholder.
    - UsagePage.tsx — "Usage & Costs" heading + placeholder ("Usage tracking coming in Phase 3")
    - ApprovalsPage.tsx — "Approvals" heading + placeholder ("Approval workflow coming in Phase 4")
    - SettingsPage.tsx — "Settings" heading + placeholder ("Configuration options coming soon")

    Each page should:
    - Accept the selectedAgentId from context (for future filtering)
    - Use consistent Tailwind styling matching stock theme
    - Be a simple functional component

    **2. Update App.tsx** to use the new layout:
    - Replace or wrap existing routing with AppLayout as the parent route
    - Add child routes: /activity, /projects, /tasks, /usage, /approvals, /settings
    - Default route (/) redirects to /tasks (since stock repo's main feature is the kanban)
    - Preserve any existing auth wrapper (Convex auth)
    - Keep the ConvexProvider setup intact

    **3. Wire the existing stock components** into the appropriate pages:
    - The stock kanban board should render inside TasksPage
    - The stock activity feed should render inside ActivityPage
    - The stock agent list functionality is now in the Sidebar
    - Preserve all stock Convex queries and mutations

    IMPORTANT: Study the existing App.tsx routing carefully before modifying. Keep all auth and provider wrappers. The goal is to restructure layout, not rewrite functionality.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `bun dev` runs, app loads at http://localhost:5173
    - Navigating to /tasks shows the stock kanban board
    - Navigating to /activity shows activity content
    - Navigating to /projects, /usage, /approvals shows placeholder pages
    - Sidebar shows agent list with status dots
    - Header shows quick stats (agent count is real, others are 0)
    - Clicking tabs navigates between pages
    - Clicking an agent in sidebar applies filter context
    - Gear icon navigates to /settings
  </verify>
  <done>
    Dashboard displays the target layout: left sidebar with agents, top header with quick stats, tab navigation across five tabs, and content area with stock components in their appropriate tabs and placeholders for future tabs. Settings accessible via gear icon.
  </done>
</task>

</tasks>

<verification>
1. Sidebar displays agent list with status indicators (green/gray/red dots)
2. Clicking an agent in sidebar sets filter context
3. Five tabs visible: Activity, Projects, Tasks, Usage, Approvals
4. Tab navigation works — clicking each tab shows the correct page
5. Header shows three quick stats
6. Gear icon opens Settings page
7. Stock kanban board visible in Tasks tab
8. Stock activity feed visible in Activity tab
9. No TypeScript errors, no console errors
</verification>

<success_criteria>
- All six layout requirements (LAYO-01 through LAYO-05 plus settings) are satisfied
- Stock functionality is preserved (kanban, activity feed, agent data)
- Layout is responsive and matches dark theme
- Convex reactive queries power the sidebar and header stats
- Clean routing with appropriate tab-to-page mapping
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
